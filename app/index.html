<!doctype html>
<html language="de">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <title>LIS-Map</title>
    <script src="../bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
    <!-- script src="data_raw.js"></script -->
    <script src="data.js"></script>

    <link rel="import" href="../bower_components/polymer/polymer.html">
    <link rel="import" href="../bower_components/google-map/google-map.html">
    <link rel="import" href="../bower_components/google-map/google-map-poly.html">
    <link rel="import" href="../bower_components/paper-button/paper-button.html">

    <style>
        body {
            margin: 0;
            height: 100vh;
        }

        #controlsToggle {
            position: absolute;
            left: 10%;
            bottom: 10%;
        }

        #flbuttons {
            position: absolute;
            left: 10%;
            bottom: 5%;
        }

        #mapDesc {
            position: absolute;
            left: 50%;
            bottom: 10%;
            background-color: aqua;
        }
    </style>
</head>

<body>

<template id="tmpl" is="dom-bind">
    <google-map min-zoom="12" max-zoom="17" fit-to-markers>
        <template is="dom-repeat" items="{{data.maps}}" observe="hidden" notify>
            <google-map-poly id="{{item.fs}}" fill-color="yellow" fill-opacity=".5" closed notify
                             hidden$="{{item.hidden}}"
                             stroke-weight=".0">
                <template is="dom-repeat" items="{{item.mps}}" as="itm">
                    <google-map-point latitude="{{itm.lat}}" longitude="{{itm.lon}}"></google-map-point>
                </template>
            </google-map-poly>
        </template>
        <template is="dom-repeat" items="{{data.maps}}">
            <template is="dom-repeat" items="{{item.mps}}" as="itm">
                <google-map-marker latitude="{{itm.lat}}" longitude="{{itm.lon}}" notify click-events title="{{item.name}}">
                    <span><h2>{{item.name}}</h2>lat:<b>{{itm.lat}}</b> lon:<b>{{itm.lon}}</b></span>
                </google-map-marker>
                <google-map-point latitude="{{itm.lat}}" longitude="{{itm.lon}}"></google-map-point>
            </template>
        </template>

    </google-map>
    <div id="flbuttons">
        <template is="dom-repeat" items="{{data.maps}}">
            <button id="{{item.fs}}" on-tap="toggleHidden">{{item.gem}}_{{item.fl}}_{{item.fs}}</button>
        </template>
    </div>

    <script>
        var tmpl = document.getElementById("tmpl");
        tmpl.toggleHidden = function (event) {
            var el = document.getElementById(event.target.id);
            // el.hidden = !el.hidden;
            el.fillOpacity = ( el.fillOpacity === 0.0 ? 0.5 : 0.0 );
        }
/*
        data.forEach(function (fs) {
            var latlons = fs.latlon.split(/\s*,\s*!/);

            var arrayLength = latlons.length;
            var ret = [];
            for (var i = 0; i < arrayLength; i++) {
                var latlon = latlons[i].split(/\s/);
                var obj = {
                    lat: latlon[0],
                    lon: latlon[1]
                }
                if (obj.lat != null && obj.lat != "" && obj.lon != null && obj.lon != "") {
                    ret.push(obj);
                }
            }
            fs.mps = ret;
        })
*/
        tmpl.data = data;

    </script>
</template>
</body>

</html>